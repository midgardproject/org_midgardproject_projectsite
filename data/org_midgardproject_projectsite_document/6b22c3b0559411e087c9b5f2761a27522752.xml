<?xml version="1.0" encoding="UTF-8"?>
<midgard_object xmlns="http://www.midgard-project.org/midgard_object/1.8">
  <org_midgardproject_projectsite_document purge="no" action="updated" guid="6b22c3b0559411e087c9b5f2761a27522752">
    <metadata>
      <creator>f6b665f1984503790ed91f39b11b5392</creator>
      <created>2011-03-23 21:27:56+0000</created>
      <revisor></revisor>
      <revised>2011-03-25 14:49:49+0000</revised>
      <revision>5</revision>
      <locker></locker>
      <locked>0001-01-01 00:00:00+0000</locked>
      <approver></approver>
      <approved>0001-01-01 00:00:00+0000</approved>
      <authors></authors>
      <owner></owner>
      <schedulestart>0001-01-01 00:00:00+0000</schedulestart>
      <scheduleend>0001-01-01 00:00:00+0000</scheduleend>
      <hidden>0</hidden>
      <navnoentry>0</navnoentry>
      <size>8561</size>
      <published>0001-01-01 00:00:00+0000</published>
      <score>0</score>
      <imported>0001-01-01 00:00:00+0000</imported>
      <exported>0001-01-01 00:00:00+0000</exported>
      <deleted>0</deleted>
      <isapproved>0</isapproved>
      <islocked>0</islocked>
    </metadata>
    <action></action>
    <id>10</id>
    <product>cf454da4553a11e08ae3f5e109c3d62dd62d</product>
    <name>structure_of_a_component</name>
    <title>Structure of a component</title>
    <content>&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;A component is a functional module that runs inside Midgard MVC. It is usually run associated to a particular Midgard MVC Node, but can also tack itself to be run alongside another component's Node.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;component_name&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;manifest.yml&amp;lt;/i&amp;gt;: Component's package manifest, routes and signal listener registration&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;configuration&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;defaults.yml&amp;lt;/i&amp;gt;: Component's default configuration, as name-value pairs&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;controllers&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;controllername.php&amp;lt;/i&amp;gt;: A controller class for the component&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;models&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;classname.xml&amp;lt;/i&amp;gt;: Midgard Schema used by the component, registers type classname&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;views&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;viewname.xml&amp;lt;/i&amp;gt;: Midgard View used by the component, registers view viewname&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;classname.php&amp;lt;/i&amp;gt;: PHP class that extends a Midgard Schema&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;services&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;authentication.php&amp;lt;/i&amp;gt;: component-specific implementation of Midgard MVC Authentication Service (these are rarely needed)&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;templates&amp;lt;/i&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;templatename.xhtml&amp;lt;/i&amp;gt;: A TAL template used by the component, named templatename&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;div&amp;gt;&amp;lt;h3&amp;gt;Defining routes&amp;lt;/h3&amp;gt;&amp;lt;p&amp;gt;Individual routes (or views) of a component are defined in the component manifest. Midgard MVC takes the route definitions and constructs Route objects out of them.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Routes map between an URL and the corresponding controller class and an action method.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Minimal route definition:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;route_identifier:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- path: '/some/url'&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- controller: controller class&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- action: action name&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- template_aliases:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;- root: name of template used when "root" is included&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;- content: name of template used when "content" is included&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;h4&amp;gt;Route matching&amp;lt;/h4&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;There are several ways Midgard MVC matches Requests to Routes. The matching is handled by providing an Intent to the factory method of the Request class:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Explicit matching&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;In an explicit match we know the component instance, route identifier and arguments&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Implicit matching&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;In implicit matching we know one or multiple of:&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Route identifier and arguments&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;URL&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Component name&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Existing request object&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;URL patterns&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Route path (under a given hierarchy node) is defined with the path property of the route. The paths follow the URL pattern specification.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Variables can be used with URL patterns in the following way:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Named variable&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;-path: '/{$foo}'&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;With request /bar the controller would be called with $args['foo'] = 'bar'&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Named and typed variable&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;-path: '/latest/{int:$number}'&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;With request /latest/5 the controller would be called with $args['number'] = 5&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Unnamed arguments&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;-path '/file/@'&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;With request /file/a/b the controller would be called with $args['variable_arguments'] = array('a', 'b')&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;h4&amp;gt;Limiting route availability&amp;lt;/h4&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;If you want routes to be accessible only when run on the root folder of the website (/), you can add the following to that route definition:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;routes:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;some_route:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;root_only: true&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Another option is to ensure a route is accessible only when used in subrequests (&amp;lt;i&amp;gt;dynamic_load&amp;lt;/i&amp;gt; and &amp;lt;i&amp;gt;dynamic_call&amp;lt;/i&amp;gt;) and not accessible directly by browser. This can be achieved by the following in route definition:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;routes:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;some_route:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;subrequest_only: true&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;The component provider handling route registration will ensure that routes not fitting these limitations will not be registered for the Request.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;h3&amp;gt;Workings of a controller&amp;lt;/h3&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Controller is a PHP class that contains one or more actions matching route definitions of a component. When invoked, Midgard MVC dispatcher will load the component, instantiate the controller class specified in route definition, passing it the Request object and a reference to request data array, and finally call the action method corresponding to the route used, passing it the arguments from the request.&amp;lt;br /&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;The controller will then do whatever processing or data fetching it needs to do. Any content the controller wants to pass to a template should be added to the data array. If any errors occur, the controller should throw an exception.&amp;lt;br /&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Actions are public methods in a controller class. Action methods are named using pattern &amp;lt;i&amp;gt;&amp;amp;lt;HTTP verb&amp;amp;gt;_&amp;amp;lt;action name&amp;amp;gt;&amp;lt;/i&amp;gt;, for example &amp;lt;i&amp;gt;get_article()&amp;lt;/i&amp;gt; or &amp;lt;i&amp;gt;post_form()&amp;lt;/i&amp;gt;. Action methods will receive the possible URL arguments as an argument containing an array.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Here is a simple example. Route definition from &amp;lt;i&amp;gt;net_example_calendar/manifest.yml&amp;lt;/i&amp;gt;:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;show_date:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- path: '/date'&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- controller: net_example_calendar_controllers_date&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- action: date&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- template_aliases:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;- content: show-date&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Controller class net_example_&amp;lt;i&amp;gt;calendar/controllers/date.php&amp;lt;/i&amp;gt;:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;&amp;amp;lt;?php&amp;lt;br /&amp;gt;class net_example_calendar_controllers_date&amp;lt;br /&amp;gt;{&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;public function __construct(midgardmvc_core_request $request)&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;{&amp;lt;br /&amp;gt;        // All controllers receive the Request instance when invoked&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;$this-&amp;amp;gt;request = $request;&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;}&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;public function get_date(array $args)&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;{&amp;lt;br /&amp;gt;        // Information we want to pass to the template should be set into the data array&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;$this-&amp;amp;gt;data['date'] = strftime('%x %X');&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;}&amp;lt;br /&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;h3&amp;gt;Showtime&amp;lt;/h3&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Once a controller has been run, the next phase in MVC execution is templating. There are two levels of templates used:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;&amp;lt;b&amp;gt;Template entry point&amp;lt;/b&amp;gt;: the "whole page" template, which includes a content area by having a &amp;amp;lt;mgd:include&amp;amp;gt;content&amp;amp;lt;/mgd:include&amp;amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;b&amp;gt;Content entry point&amp;lt;/b&amp;gt;: the "content area" of a page, as defined in the main template&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Each route definition can decide what templates to use in each of these. If a route wants to override the whole site template, then the route should define its own template entry point, and if it only wants to show something in the content area, then it should define its own content entry point.&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;Templates are defined by giving them a name. For example, a template for displaying the current date could be called show-date. When MVC gets into the templating stage. This is defined in the route:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;show_date:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- path: '/date'&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- controller: net_example_calendar_date&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- action: date&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0;- template_aliases:&amp;lt;br /&amp;gt;&amp;#xA0;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;- content: show-date&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;When the templating phase of the route happens, MVC will look for such element from the template stack. Template stack is a list of components running with the current request. First MVC looks for the element in the current component, and if it can't be found there it goes looking for it down the stack:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Current running component's&amp;#xA0;&amp;lt;i&amp;gt;templates&amp;lt;/i&amp;gt; directory&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;i&amp;gt;templates&amp;lt;/i&amp;gt; directories of any components injected to the template stack&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Midgard MVC core &amp;lt;i&amp;gt;templates&amp;lt;/i&amp;gt; directory&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;p&amp;gt;The first matching template element will be used and executed via TAL. The data returned by the component will be exposed into TAL as a current_component variable. In case of our date example the template could simply be a &amp;lt;i&amp;gt;net_example_calendar/templates/show-date.xhtml&amp;lt;/i&amp;gt; file with following contents:&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;pre&amp;gt;&amp;amp;lt;p&amp;amp;gt;Current date is &amp;amp;lt;span tal:content="current_component/date"&amp;amp;gt;5/8/1999 01:00&amp;amp;lt;/span&amp;amp;gt;&amp;amp;lt;/p&amp;amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Please consult the &amp;lt;a href="http://phptal.org/manual/en/"&amp;gt;PHPTAL manual&amp;lt;/a&amp;gt; for more information on using TAL templating commands.&amp;lt;br /&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;</content>
  </org_midgardproject_projectsite_document>
</midgard_object>
